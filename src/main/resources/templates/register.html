<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <style>
    /* ===== BASE ===== */
    *{margin:0;padding:0;box-sizing:border-box}
    body{
        font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
        background:#f8f7ff;color:#333
    }
    .container{display:flex;min-height:100vh}

    /* ===== SIDEBAR ===== */
    .sidebar{
        width:240px;background:#fff;padding:30px 20px;
        box-shadow:2px 0 10px rgba(0,0,0,.05)
    }
    .logo{display:flex;align-items:center;gap:12px;margin-bottom:10px}
    .logo-icon{
        width:40px;height:40px;
        background:linear-gradient(135deg,#a78bfa,#8b5cf6);
        border-radius:12px;
        display:flex;align-items:center;justify-content:center;
        font-size:14px;
        font-weight:700;
        letter-spacing:0.08em;
        text-transform:uppercase;
        color:#fff;
    }
    .logo h1{color:#8b5cf6;font-size:20px}
    .welcome-text{color:#a78bfa;font-size:14px;margin-bottom:30px}
    .nav-menu{list-style:none}
    .nav-item a{
        display:flex;gap:12px;padding:12px 15px;
        border-radius:10px;text-decoration:none;color:#666
    }
    .nav-item a.active,.nav-item a:hover{
        background:#f3f0ff;color:#8b5cf6;font-weight:600
    }

    /* ===== MAIN ===== */
    .main-content{flex:1;padding:30px 40px}
    .page-header h2{font-size:28px;margin-bottom:20px}

    /* ===== CARD ===== */
    .card{
        background:#fff;padding:30px;border-radius:16px;
        margin-bottom:30px;box-shadow:0 4px 15px rgba(0,0,0,.06)
    }
    .section-title{font-size:20px;margin-bottom:20px}

    /* ===== TABLE ===== */
    .book-table{width:100%;border-collapse:collapse}
    .book-table th{
        background:#f9f7ff;padding:15px;text-align:left;
        border-bottom:2px solid #e5e7eb
    }
    .book-table td{padding:15px;border-bottom:1px solid #f3f4f6}
    .book-table img{height:80px;border-radius:8px;object-fit:cover}

    /* ===== BUTTONS ===== */
    .edit-btn{
        padding:8px 16px;background:#e0e7ff;color:#4338ca;
        border-radius:8px;font-weight:600;border:none;cursor:pointer
    }
    .edit-btn:hover{background:#c7d2fe}
    .delete-btn{
        padding:8px 16px;background:#fee2e2;color:#dc2626;
        border-radius:8px;font-weight:600;border:none;cursor:pointer
    }

    /* ===== MODAL ===== */
    .modal{
        position:fixed;inset:0;
        background:rgba(0,0,0,.45);
        display:none;align-items:center;justify-content:center;
        z-index:1000
    }
    .modal-box{
        background:#fff;padding:30px;border-radius:18px;
        width:420px;box-shadow:0 20px 40px rgba(0,0,0,.2)
    }
    .modal-box h3{
        margin-bottom:20px;color:#7c3aed
    }
    .modal-box label{
        display:block;margin-bottom:6px;font-weight:500;color:#7c3aed
    }
    .modal-box input{
        width:100%;padding:12px;border:2px solid #e5e7eb;
        border-radius:10px;margin-bottom:15px
    }
    .modal-actions{
        display:flex;gap:10px;justify-content:flex-end
    }
    .modal-actions button{
        padding:10px 18px;border-radius:10px;font-weight:600;border:none
    }
    .save-btn{
        background:linear-gradient(135deg,#a78bfa,#8b5cf6);color:#fff
    }
    .cancel-btn{background:#f3f4f6}
  </style>
</head>
<body>

<div class="container">

  <aside class="sidebar">
    <div class="logo">
      <div class="logo-icon">LB</div>
      <h1>LIBRA</h1>
    </div>
    <p class="welcome-text">Welcome, <strong sec:authentication="name"></strong></p>
  </aside>

  <main class="main-content">

    <div class="page-header">
      <h2>Manage Books</h2>
    </div>

    <div class="card">
      <h3 class="section-title">Existing Books</h3>

      <table class="book-table">
        <thead>
        <tr>
          <th>Cover</th><th>ID</th><th>Title</th>
          <th>Author</th><th>Category</th>
          <th>Available</th><th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="b : ${books}">
          <td><img th:if="${b.coverUrl}" th:src="@{${b.coverUrl}}"></td>
          <td th:text="${b.id}"></td>
          <td th:text="${b.title}"></td>
          <td th:text="${b.author}"></td>
          <td th:text="${b.category}"></td>
          <td th:text="${b.availableCopies + '/' + b.totalCopies}"></td>
          <td>
            <button class="edit-btn"
                    th:attr="onclick=|openEdit('${b.id}','${b.title}','${b.author}','${b.category}','${b.totalCopies}')|">
              Edit
            </button>

            <form th:action="@{'/books/' + ${b.id} + '/delete'}" method="post" style="display:inline">
              <button class="delete-btn">Delete</button>
            </form>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

  </main>
</div>

<!-- ===== MODAL ===== -->
<div class="modal" id="editModal">
  <form class="modal-box" method="post" action="/books/update">
    <h3>Edit Book</h3>

    <input type="hidden" name="id" id="editId">

    <label>Title</label>
    <input name="title" id="editTitle">

    <label>Author</label>
    <input name="author" id="editAuthor">

    <label>Category</label>
    <input name="category" id="editCategory">

    <label>Total Copies</label>
    <input type="number" min="1" name="totalCopies" id="editTotal">

    <div class="modal-actions">
      <button type="button" class="cancel-btn" onclick="closeEdit()">Cancel</button>
      <button type="submit" class="save-btn">Save</button>
    </div>
  </form>
</div>

<script>
  function openEdit(id,title,author,category,total){
      editId.value=id;
      editTitle.value=title;
      editAuthor.value=author;
      editCategory.value=category;
      editTotal.value=total;
      editModal.style.display='flex';
  }
  function closeEdit(){
      editModal.style.display='none';
  }
</script>

</body>
</html>

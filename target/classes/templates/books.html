<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::section})}">
<section>

    <h2>ðŸ“š Manage Books</h2>

    <!-- SEARCH -->
    <form method="get" action="/books">
        <input name="q" th:value="${q}" placeholder="Search title / author / category">
        <button type="submit">Search</button>
        <a href="/books">Reset</a>
    </form>

    <hr>

    <!-- ADD BOOK -->
    <h3>Add Book</h3>
    <form method="post" action="/books"
          th:object="${newBook}"
          enctype="multipart/form-data">

        <input type="file" name="coverFile" required>
        <input th:field="*{id}" placeholder="ID" required>
        <input th:field="*{title}" placeholder="Title" required>
        <input th:field="*{author}" placeholder="Author" required>
        <input th:field="*{category}" placeholder="Category" required>
        <input th:field="*{totalCopies}" type="number" min="1" required>

        <button type="submit">Add Book</button>
    </form>

    <hr>

    <!-- BOOK LIST (THIS IS WHAT WAS MISSING) -->
    <h3>Existing Books</h3>

    <table border="1" width="100%">
        <tr>
            <th>Cover</th>
            <th>ID</th>
            <th>Title</th>
            <th>Author</th>
            <th>Category</th>
            <th>Available</th>
            <th>Action</th>
        </tr>

        <tr th:each="b : ${books}">
            <td>
                <img th:if="${b.coverUrl != null}"
                     th:src="@{${b.coverUrl}}"
                     style="height:80px;">
            </td>
            <td th:text="${b.id}"></td>
            <td th:text="${b.title}"></td>
            <td th:text="${b.author}"></td>
            <td th:text="${b.category}"></td>
            <td th:text="${b.availableCopies + '/' + b.totalCopies}"></td>
            <td>
                <form th:action="@{'/books/' + ${b.id} + '/delete'}" method="post">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
    </table>

</section>
</html>

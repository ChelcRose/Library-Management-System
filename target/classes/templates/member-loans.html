<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <title>My Loans | Library MS</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}

    body{
        font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
        background:#f8f7ff;color:#333
    }

    .container{display:flex;min-height:100vh}

    /* ===== SIDEBAR (SAME AS DASHBOARD) ===== */
    .sidebar{
        width:240px;background:#fff;padding:30px 20px;
        box-shadow:2px 0 10px rgba(0,0,0,.05)
    }

    .logo{display:flex;align-items:center;gap:12px;margin-bottom:10px}
    .logo-icon{
        width:40px;height:40px;
        background:linear-gradient(135deg,#a78bfa,#8b5cf6);
        border-radius:10px;
        display:flex;align-items:center;justify-content:center;
        font-size:20px
    }
    .logo h1{color:#8b5cf6;font-size:20px}
    .welcome-text{color:#a78bfa;font-size:14px;margin-bottom:30px}

    .nav-menu{list-style:none}
    .nav-item a{
        display:flex;gap:12px;padding:12px 15px;
        border-radius:10px;text-decoration:none;color:#666
    }
    .nav-item a:hover,
    .nav-item a.active{
        background:#f3f0ff;color:#8b5cf6;font-weight:600
    }

    /* ===== MAIN ===== */
    .main-content{flex:1;padding:30px 40px}

    .top-bar{
        display:flex;justify-content:space-between;
        align-items:center;margin-bottom:10px
    }

    .username{color:#8b5cf6;font-weight:600}

    .logout-btn{
        padding:10px 20px;border:none;border-radius:10px;
        background:linear-gradient(135deg,#a78bfa,#8b5cf6);
        color:#fff;font-weight:600;cursor:pointer
    }

    .page-header h2{font-size:28px;margin-bottom:25px}

    /* ===== CARD ===== */
    .card{
        background:#fff;padding:30px;border-radius:16px;
        margin-bottom:30px;
        box-shadow:0 4px 15px rgba(0,0,0,.06)
    }

    .section-title{
        font-size:20px;margin-bottom:20px;
        color:#1f1f1f;font-weight:600
    }

    /* ===== TABLE ===== */
    .loan-table{
        width:100%;border-collapse:collapse
    }

    .loan-table th{
        background:#f9f7ff;padding:15px;
        text-align:left;border-bottom:2px solid #e5e7eb
    }

    .loan-table td{
        padding:15px;border-bottom:1px solid #f3f4f6
    }

    .status-active{
        color:#f59e0b;font-weight:600
    }

    .status-returned{
        color:#10b981;font-weight:600
    }

    @media(max-width:768px){
        .container{flex-direction:column}
        .sidebar{width:100%}
    }
  </style>
</head>
<body>

<div class="container">

  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-icon">ðŸ“š</div>
      <h1>Library System</h1>
    </div>

    <p class="welcome-text">
      Welcome, <strong sec:authentication="name"></strong>
    </p>

    <ul class="nav-menu" sec:authorize="hasRole('MEMBER')">
      <li class="nav-item">
        <a href="/dashboard">
          <span>ðŸ“Š</span><span>Overview</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="/member/loans" class="active">
          <span>ðŸ“š</span><span>My Borrowed Books</span>
        </a>
      </li>
    </ul>
  </aside>

  <!-- ===== MAIN ===== -->
  <main class="main-content">

    <div class="top-bar">
      <div></div>
      <div>
        <span class="username" sec:authentication="name"></span>
        <form method="post" action="/logout" style="display:inline">
          <button class="logout-btn">Logout</button>
        </form>
      </div>
    </div>

    <div class="page-header">
      <h2>ðŸ“š My Borrowed Books</h2>
    </div>

    <!-- ===== CURRENTLY BORROWED ===== -->
    <div class="card">
      <h3 class="section-title">Currently Borrowed</h3>

      <table class="loan-table">
        <thead>
        <tr>
          <th>Loan ID</th>
          <th>Book ID</th>
          <th>Borrowed</th>
          <th>Due Date</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="l : ${activeLoans}">
          <td th:text="${l.loanId}"></td>
          <td th:text="${l.bookId}"></td>
          <td th:text="${l.borrowDate}"></td>
          <td class="status-active" th:text="${l.dueDate}"></td>
        </tr>
        <tr th:if="${#lists.isEmpty(activeLoans)}">
          <td colspan="4">No active loans</td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- ===== BORROW HISTORY ===== -->
    <div class="card">
      <h3 class="section-title">Borrow History</h3>

      <table class="loan-table">
        <thead>
        <tr>
          <th>Loan ID</th>
          <th>Book ID</th>
          <th>Borrowed</th>
          <th>Returned</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="l : ${allLoans}">
          <td th:text="${l.loanId}"></td>
          <td th:text="${l.bookId}"></td>
          <td th:text="${l.borrowDate}"></td>
          <td>
            <span th:if="${l.returnDate == null}" class="status-active">â€”</span>
            <span th:if="${l.returnDate != null}"
                  class="status-returned"
                  th:text="${l.returnDate}"></span>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(allLoans)}">
          <td colspan="4">No loan history</td>
        </tr>
        </tbody>
      </table>
    </div>

  </main>
</div>

</body>
</html>
